global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "rules/*.yaml"

scrape_configs:
  - job_name: 'kubernetes-pods'
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_label_app]
        action: keep
        regex: symphonia.*
      - source_labels: [__meta_kubernetes_pod_container_port_name]
        action: keep
        regex: metrics

  - job_name: 'symphonia-analysis'
    kubernetes_sd_configs:
      - role: pod
        selectors:
          - role: pod
            label: "app=symphonia,component=audio-analysis"
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_label_component]
        target_label: component
      - source_labels: [__meta_kubernetes_pod_name]
        target_label: pod

  - job_name: 'symphonia-export'
    kubernetes_sd_configs:
      - role: pod
        selectors:
          - role: pod
            label: "app=symphonia,component=export"
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_label_component]
        target_label: component
      - source_labels: [__meta_kubernetes_pod_name]
        target_label: pod

  - job_name: 'node'
    kubernetes_sd_configs:
      - role: node
    relabel_configs:
      - source_labels: [__meta_kubernetes_node_name]
        target_label: node