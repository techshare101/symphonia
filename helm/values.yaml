# Default values for Symphonia
# This is a YAML-formatted file.

global:
  environment: production
  domain: symphonia.ai
  
  # Container registry settings
  registry:
    server: ghcr.io
    repository: symphonia
    
  # Common labels
  labels:
    app: symphonia
    
  # Resource requests and limits
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi
      
  # Common environment variables
  env:
    NODE_ENV: production
    LOG_LEVEL: info

# API Service Configuration
api:
  name: symphonia-api
  replicas: 3
  
  image:
    repository: "{{ .Values.global.registry.server }}/{{ .Values.global.registry.repository }}/api"
    tag: latest
    pullPolicy: Always
    
  service:
    type: ClusterIP
    port: 80
    targetPort: 3000
    
  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: nginx
      cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - host: api.{{ .Values.global.domain }}
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: api-tls
        hosts:
          - api.{{ .Values.global.domain }}
          
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
      
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

# Worker Service Configuration
worker:
  name: symphonia-worker
  replicas: 2
  
  image:
    repository: "{{ .Values.global.registry.server }}/{{ .Values.global.registry.repository }}/worker"
    tag: latest
    pullPolicy: Always
    
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 2000m
      memory: 4Gi
      
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 15
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
    
  queue:
    type: redis
    size: 10000

# ML Service Configuration
ml:
  name: symphonia-ml
  replicas: 2
  
  image:
    repository: "{{ .Values.global.registry.server }}/{{ .Values.global.registry.repository }}/ml"
    tag: latest
    pullPolicy: Always
    
  service:
    type: ClusterIP
    port: 80
    targetPort: 5000
    
  resources:
    requests:
      cpu: 1000m
      memory: 2Gi
    limits:
      cpu: 4000m
      memory: 8Gi
      
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 8
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
    
  gpu:
    enabled: true
    type: nvidia-tesla-t4
    count: 1

# Monitoring Configuration
monitoring:
  enabled: true
  
  prometheus:
    enabled: true
    retention: 15d
    storageSize: 50Gi
    
  grafana:
    enabled: true
    adminPassword: "{{ .Values.secrets.grafana.adminPassword }}"
    persistence:
      enabled: true
      size: 10Gi
      
  alertmanager:
    enabled: true
    slack:
      channel: "#symphonia-alerts"
      webhook: "{{ .Values.secrets.slack.webhook }}"
    pagerduty:
      serviceKey: "{{ .Values.secrets.pagerduty.serviceKey }}"

# MLflow Configuration
mlflow:
  enabled: true
  
  tracking:
    uri: http://mlflow.{{ .Values.global.domain }}
    backend: postgresql
    artifacts:
      storage: gcs
      bucket: symphonia-ml-artifacts
      
  postgresql:
    enabled: true
    persistence:
      size: 20Gi
      
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 2Gi

# Storage Configuration
storage:
  class: standard
  
  redis:
    enabled: true
    persistence:
      enabled: true
      size: 10Gi
    cluster:
      enabled: true
      replicas: 3
      
  postgresql:
    enabled: true
    persistence:
      enabled: true
      size: 50Gi
    replication:
      enabled: true
      replicas: 2
      
  minio:
    enabled: true
    persistence:
      enabled: true
      size: 100Gi

# Security Configuration
security:
  networkPolicy:
    enabled: true
    
  rbac:
    create: true
    
  podSecurityPolicy:
    enabled: true
    
  securityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000

# Secrets Management
secretsManager:
  provider: aws-secrets-manager
  region: us-west-2
  
# Logging Configuration
logging:
  enabled: true
  
  elasticsearch:
    enabled: true
    replicas: 3
    storage:
      size: 100Gi
      
  kibana:
    enabled: true
    
  filebeat:
    enabled: true
    
# Backup Configuration
backup:
  enabled: true
  schedule: "0 1 * * *"
  retention: 30d
  
  destinations:
    - s3:
        bucket: symphonia-backups
        region: us-west-2
    - gcs:
        bucket: symphonia-backups
        
# Environments
environments:
  staging:
    global:
      domain: staging.symphonia.ai
    api:
      replicas: 2
    worker:
      replicas: 1
    ml:
      replicas: 1
    monitoring:
      retention: 7d
      storageSize: 20Gi
      
  production:
    global:
      domain: symphonia.ai
    api:
      replicas: 3
    worker:
      replicas: 2
    ml:
      replicas: 2
    monitoring:
      retention: 30d
      storageSize: 100Gi